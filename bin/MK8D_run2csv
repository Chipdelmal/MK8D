#!/usr/bin/env python

import sys
from glob import glob
from os import path
import MK8D as mk
import numpy as np


(PATH_I, PATH_O, FILE_O) = (sys.argv[1], sys.argv[2], sys.argv[3])
files = glob(path.join(PATH_I, '*.lss'))
print('Parsing {} files to CSV dataframe.'.format(len(files)))
data = mk.compileRunsDataframeFromFiles(files, prependID=True)

tracksFltr = mk.TRACKS
fshdRunsIDs = sorted(list(mk.getFinishedRunsID(data, tracksFltr)))
fshdRuns = mk.getFinishedRuns(data, tracksFltr)
runsCTimes = mk.convertFinishedRunsToCTimes(fshdRuns, fshdRunsIDs, tracksFltr)

cFun = np.median
runsCTimesC = mk.centerRunsCTimes(runsCTimes, centerFunction=cFun)

runsCTimesC.to_csv(path.join(PATH_O, FILE_O), index=False)